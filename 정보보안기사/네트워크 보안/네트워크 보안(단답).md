1. [데이터 링크 계층](#데이터-링크-계층)<br>
   &nbsp;&nbsp; 1-1.[데이터 링크 계층에서 수행하는 기능](#데이터-링크-계층에서-수행하는-기능)<br>
   &nbsp;&nbsp; 1-1-1.[정지-대기 기법(Stop and Wait)](#정지-대기-기법stop-and-wait)<br>
   &nbsp;&nbsp; 1-1-2.[슬라이딩 윈도우(Sliding Window)](#슬라이딩-윈도우sliding-window)<br>
2. [CSMA/CD](#csmacd-carrier-sense-multiple-accesscollision-detection)<br>
3. [CSMA/CA](#csmaca-carrier-sense-multiple-accesscollision-avoidance)<br>
4. [L2-Switch 전송 방식](#l2-switch의-전송-방식)<br>
   &nbsp;&nbsp; 4-1. [Store and Forward 방식](#store-and-forward-방식)<br>
   &nbsp;&nbsp; 4-2. [Cut Through 방식](#cut-through-방식)<br>
   &nbsp;&nbsp; 4-3. [Fragment Free 방식](#fragment-free-방식)<br>
5. [Port Mirroring(포트 미러링)](#port-mirroring포트-미러링)<br>
6. [허브(더미 허브)](#허브더미-허브)<br>
7. [스위치(스위칭 허브)](#스위치스위칭-허브)<br>
8. [스패닝 트리(spanning tree)](#스패닝-트리spanning-tree)<br>
9. [유니캐스트(Unicast)](#유니캐스트unicast)<br>
10. [멀티캐스트(Multicast)](#멀티캐스트multicast)<br>
11. [브로드캐스트(Broadcast)](#브로드캐스트broadcast)<br>
    &nbsp;&nbsp;11-1. [MAC 주소에서 브로드캐스트 주소](#mac-주소에서-브로드캐스트-주소)<br>
    &nbsp;&nbsp;11-2. [3계층 IP 주소의 Direct 브로드캐스트 주소](#3계층-ip-주소의-direct-브로드캐스트-주소)<br>
12. [데이터 링크 계층(Data Link)](#데이터-링크-계층data-link)<br>
    &nbsp;&nbsp;12-1. [LLC(Logical Link Control)](#llclogical-link-control)<br>
    &nbsp;&nbsp;12-2. [MAC(Media Access Control)](#macmedia-access-control)<br>
13. [네트워크 계층](#네트워크-계층)<br>
    &nbsp;&nbsp; 13-1. [라우터(router)](#라우터router)<br>
14. [전송 계층(Transport)](#전송-계층transport)<br>
15. [표현 계층(Presentation Layer)](#표현-계층presentation-layer)<br>
16. [PDU(Protocaol Data Unit)](#pduprotocol-data-unit)<br>
17. [VLAN(Virtual LAN)](#vlanvirtual-lan)<br>
    &nbsp;&nbsp; 17-1. [VLAN 종류](#vlan-종류)<br>
18. [ARP(Address Resolution Protocol)](#arpaddress-resolution-protocol)<br>
19. [RARP(Reverse ARP)](#rarpreverse-arp)<br>
20. [ARP 스푸핑(Spoofing)](#arp-스푸핑spoofing)<br>
21. [스위치 재밍(Switch Jamming)](#스위치-재밍switch-jamming)<br>
22. [TTL(Time to Live)](#ttltime-to-live)<br>
23. [IP 데이터그램을 단편화할 때 tcpdump의 출력 형식](#ip-데이터그램을-단편화할-때-tcpdump의-출력-형식)<br>
24. [MTU가 1500바이트일 때 첫 번째 단편의 크기](#mtu가-1500바이트일-때-첫-번째-단편의-크기)<br>
25. [IP 스푸핑(Spoofing)](#ip-스푸핑spoofing)<br>
26. [트러스트 관계](#트러스트-관계)<br>
27. [IPv4에서 IPv6로 전환하는 방법](#ipv4에서-ipv6로-전환하는-방법)<br>
    &nbsp;&nbsp;27-1. [듀얼스택(Dual Stack)](#듀얼스택dual-stack)<br>
    &nbsp;&nbsp;27-2. [터널링](#터널링)<br>
    &nbsp;&nbsp;27-3. [주소/헤더 변환(Address / Header Translation)](#주소헤더-변환address--header-translation)<br>
28. [ICMP(Internet Control Message Protocol)](#icmpinternet-control-message-protocol)<br>
29. [ICMP Redirect 메시지](#icmp-redirect-메시지)<br>
30. [IGMP(Internet Group Management Protocol)](#igmpinternet-group-management-protocol)<br>
31. [TCP 프로토콜의 제어 플래그](#tcp-프로토콜의-제어-플래그)<br>
32. [소켓(Socket)](#소켓socket)<br>
33. [Well Known 포트(0~1023)](#well-known-포트0--1023)<br>
    &nbsp;&nbsp;33-1. [프로토콜과 포트번호](#프로토콜과-포트번호)<br>
34. [Registered Port(1024 ~ 49151)](#registered-port1024--49151)<br>
35. [TCP](#tcp)<br>
36. [UDP](#udp)<br>
37. [세션 하이재킹(Session Hijacking)](#세션-하이재킹session-hijacking)<br>
    &nbsp;&nbsp;36-1. [TCP 세션 하이재킹(TCP Session Hijacking)](#tcp-세션-하이재킹tcp-session-hijacking)<br>
    &nbsp;&nbsp;36-2. [HTTP 세션 하이재킹(HTTP Session Hijacking)](#http-세션-하이재킹http-session-hijacking)<br>
38. [NetBIOS(Network Basic Input/Output System)](#netbiosnetwork-basic-inputoutput-system)<br>
39. [CIFS(Common Internet File System)](#cifscommon-internet-file-systemsmbserver-message-block)<br>
40. [ping](#ping)<br>
41. [netstate 명령어](#netstate-명령어)<br>
    &nbsp;&nbsp;41-1. [netstate 명령어 옵션](#netstate-명령어-옵션)<br>
    &nbsp;&nbsp;41-2. [자주 사용하는 netstate 옵션 예시](#자주-사용하는-netstate-옵션-예시)<br>
42. [traceroute](#traceroute)<br>
43. [tracert](#tracert)<br>
44. [포트 스캐닝(Port Scanning)](#포트-스캐닝port-scanning)<br>
    &nbsp;&nbsp;44-1. [TCP 포트 스캔 방법](#tcp-포트-스캔-방법)<br>
45. [스텔스 스캔(Stealth Scan)](#스텔스-스캔stealth-scan)<br>

# 데이터 링크 계층

- 인접한 노드 간의 신뢰성 있는 프레임 전송을 담당하는 계층이다.
  - 목적지 노드를 식별하기 위해선 물리적인 주소가 필요하며 네트워크 카드(NIC)의 MAC 주소가 해당 역할을 수행한다.
- 6바이트로 구성된다.
- MAC Address
  - 앞의 3바이트는 제조사(벤더) 코드, 뒤의 3바이트는 제조사(벤더)에서 할당한 코드이다.

## 데이터 링크 계층에서 수행하는 기능

1. 회선제어

- 점대점 또는 멀티포인트 회선 구성 방식과 단방향, 반이중 및 전이중 등의 통신방식에 따라 사용되는 전송링크에 대한 제어 규범이다.
- 데이터 통신 시스템에서 중앙 처리 장치와 복수의 통신 회선 사이에서 데이터의 상호 전송을 제어한다.
- 보통 회선 제어 장치에 의해 시분할 다중적으로 공통 제어된다.

2. 흐름제어

- 수신 장치의 용량 이상으로 데이터가 넘치지 않도록 송신장치를 제어하는 기술이다.
  - 즉, 수신 장치가 이전에 받은 데이터를 자신의 버퍼에서 처리하기 전 송신장치로부터 다른 데이터가 전송되지 않도록 하는 제어방식이다.
  - 정지 대기(Stop and Wait) 기법, 슬라이딩 윈도우(Sliding Window) 기법이 있다.
- 통신 당사자 간의 데이터 흐름을 규제하는 경우 송신 속도가 수신 측의 처리 능력을 초과하지 않도록 데이터 흐름을 조절한다.

3. 오류제어

- 여러 가지 원인으로 인해 전송된 데이터가 발생할 수 있는 오류에 대한 해결을 위한 제어방식이다.
- 전송 도중 발생한 부호 오류를 검출하고, 정확한 정보를 재현하는 기술 오류제어 기술로는 오류 정정 부호에 의하여 오류를 정정하는 순방향 오류 정정(FEC)과 오류 검출 부호를 사용하여 재송신하는 자동 재송 요구(ARQ)등이 있다.

### 정지-대기 기법(Stop and Wait)

- 흐름제어 기법 중 하나이다.
- 송신 측이 1개의 데이터를 전송하면 수신 측에서 오류 발생 여부를 점검하여 긍정 응답(ACK)이나 부정 응답(NAK)를 보낼 때까지 기다리는 방식이다.
  - 수신 측은 전송 중 오류가 발생하면 NAK를 보내고, 오류가 발생하지 않으면 ACK를 보낸다.
  - 이후, 다음 데이터를 전송하거나 NAK를 수신받으면 데이터를 재전송한다.

### 슬라이딩 윈도우(Sliding Window)

- 흐름제어 기법 중 하나이다.
- 한번에 여러개의 데이터를 보낼 수 있다.
- 수신 측에 보낼 수 있는 최대 크기(윈도우 크기) 내에서 수신 측 응답이 없어도 데이터를 연속해서 전송하는 방식이다.

# CSMA/CD (Carrier Sense Multiple Access/Collision Detection)

- 이더넷(IEEE 802.3) 표준에서 사용하는 매체 접근 제어 방식이다.
- 공유매체가 사용 중인지를 감지한 후 매체가 비어있다면 프레임을 전송하고, 전송 완료 이전에 신호 충돌을 탐지하여 충돌이 발생하면 임의의 시간 동안 대기한 후 재전송을 수행하는 접근 제어 방식이다.

# CSMA/CA (Carrier Sense Multiple Access/Collision Avoidance)

- 무선랜(IEEE 802.11) 표준에서 사용하는 매체 접근 방식이다.
- 무선랜 환경은 충돌 탐지가 어렵게 때문에 사전에 충돌을 회피하는 방식을 사용한다.
- 전송 전에 매체 사용 여부를 확인하고 일정 시간 대기후에 전송 및 수신 여부를 확인하여 실패 시 재전송을 수행하는 접근 제어 방식이다.

# 충돌 도메인(Collision Domain)

- 매체를 공유하는 LAN에서 하나의 장비가 데이터를 보내고 있을 때 또 다른 장비가 데이터를 동시에 보내면 충돌이 발생한다.

# 브로드케스트 도메인(Boradcast Domain)

- 어떠한 단말이 송신한 브로드 캐스트 패킷이 전달되는 허용 영역을 말한다.
- 영역 내에 있는 단말을 직접 통신이 가능하며, 허용 영역은 라우터 사용을 기준으로 분할된다.

# L2-Switch의 전송 방식

## Store and Forward 방식

- 유입된 전체 프레임을 버퍼에 저장하고 CRC 등의 오류 검사를 수행한 후 목적지로 전송하는 방식이다.
- 전체 프레임에 대한 오류 검사를 수행하기 때문에 신뢰성이 높지만, 지연 시간이 발생한다.

## Cut Through 방식

- 수신된 프레임의 첫 6byte를 읽어 `Destination MAC 주소(목적지 MAC 주소)만 검사한 후 즉시 목적지로 전송`하는 방식이다.
- 지연 시간이 줄어 빠른 전송이 가능하지만 프레임 오류 검사를 하지 않기에 신뢰성이 낮다.
- 스위치의 `중계 지연 시간(Forwarding Time Latency)을 최소화하기 위해 사용`되는 전송 방식이다.

## Fragment Free 방식

- Store and Forward 방식과 Cut Through 방식을 결합한 방식이다.
- 유입된 프레임의 첫 64byte를 버퍼에 저장하고, 충돌 등 오류 검사를 수행한 후 목적지로 전송하는 방식이다.

# Port Mirroring(포트 미러링)

- 스위치 환경에서 모니터링과 트래픽 분석을 위해 `특정 포트로 전달되는 패킷 또는 VLAN의 모든 패킷을 다른 모니터링 포트로 복제하여 전달`하는 기능이다.
  - 스위치는 허브처럼 `특정 포트에서 유입된 패킷을 모든 포트로 전달하지 않기 때문에 스위치로 전달되는 패킷을 분석하기 위해선 포트 미러링을 사용`해야 한다.

# 허브(더미 허브)

- 단일 네트워크 구간에서 사용된다.
- 한 포트에서 수신한 신호를 모든 포트로 전달할 뿐 트래픽을 조작하거나, 검사하지 않는다.
- 제어 기능이 없고, 충돌 도메인과 브로드캐스트 도메인을 구분하지 못하며, 연결된 모든 장비는 속도를 공유한다.

# 스위치(스위칭 허브)

- 단일 네트워크 구간에서 사용된다.
- 한 포트에서 수신한 신호를 목적지 포트로만 전달한다.
- 확장 제한이 없으며, 이중화시 스패닝 트리(spanning tree) 프로토콜을 이용하여 무한 루핑을 방지할 수 있다.

# 스패닝 트리(spanning tree)

- `스위치 이중화 시 루프가 생기는 것을 방지`하기 위한 프로토콜이다.
- `이중화 구성된 라인을 논리적으로 한 부분만 포트를 막는다.`
  - 만일, 사용 중인 라인에 문제가 발생하면 논리적으로 막은 포트를 다시 열어 링크를 연결한다.

# 유니캐스트(Unicast)

- `하나의 송신자`가 `하나의 수신자`에게 패킷을 보내는 방식이다.(특정인에게 전송)

# 멀티캐스트(Multicast)

- `하나의 송신자`가 `멀티캐스트 그룹의 수신자`에게 패킷을 보내는 경우이다.
  - `일대다`의 패킷 전송 방식이다.
- 멀티캐스트 전송을 수행하기 위해선 네트워크 장치가 멀티캐스트를 지원해야 하며, 멀티캐스트 그룹에 가입되어 있어야 한다.

# 브로드캐스트(Broadcast)

- `같은 네트워크에 있는 모든 호스트들에게 패킷을 보내는 방식`이다.
- 브로드캐스트 IP 주소에선 호스트 ID 비트를 모두 1로 설정해야 한다.(불특정 다수에게 전송)

## MAC 주소에서 브로드캐스트 주소

- 데이터 링크 계층(2 계층)에서 예약된 브로드캐스트 주소는 48비트 모두 1로 설정된 주소이다.
  - 8bit 단위 헥사값으로 :(콜론)을 구분자로 표현한다.
- `FF:FF:FF:FF:FF:FF`

## 3계층 IP 주소의 Direct 브로드캐스트 주소

- 해당 서브넷의 호스트 ID 비트가 모두 1인 주소를 말한다.
- 161.134.4.0/22 서브넷의 경우 하위 10비트가 모두 1인 주소가 Direct 브로드캐스트 주소가 된다.
  - 즉, 161.134.7.255가 Direct 브로드캐스트 주소이다.

# 데이터 링크 계층(Data Link)

- OSI 참조모델의 2번째 계층이다.
- 전송 데이터 단위로 `프레임`을 사용한다.
- 대표적인 장비로 `스위치, 브릿지` 등이 있다.
- 대표적인 보안 프로토콜로 `PPTP, L2F, L2TP` 등이 있다.
- 유/무선 LAN 기술의 주요 기능이 위치하는 곳이다.
  - ex) 이더넷, 토큰 링, FDDI, 802.11(무선랜/WIFI) 등이 해당한다.
- 데이터 패킷을 생성하고 전송하는 방법을 규정하는 프로토콜에 대한 계층이다.
- 데이터 링크 계층은 `하위 계층인 MAC 계층`과 `상위 계층인 LLC 계층으로 분류`할 수 있다.

## LLC(Logical Link Control)

- 장비 간 `논리적인 연결을 수립하고 제어`하는 역할을 담당하는 계층이다.
- 다양한 LAN 기술/프로토콜에서 공통으로 필요한 `회선제어, 흐름제어, 오류제어 등을 담당`한다.

## MAC(Media Access Control)

- 장비 간 공유 매체(공유 회선/링크)에 대한 `다중 접근 제어`를 담당하는 계층이다.
  - ex) 매체 접근 제어를 위해 이더넷은 CSMA/CD 방식을 사용한다.

# 네트워크 계층

- 송신 측으로부터 수신 측까지 데이터를 안전하게 전달하기 위해 논리적 링크를 설정한다.
  - 데이터가 목적지까지 올바르게 도달할 수 있도록 `경로 선택 및 라우팅 기능을 수행한다.`
- 상위 계층 데이터를 작은 크기의 패킷으로 나누어 전송하는 역할을 한다.
- 데이터 전송 단위로 `패킷`을 사용한다.
- IP 프로토콜이 대표적이다.

## 라우터(router)

- `네트워크 계층`에서 사용하는 장비이다.
- `패킷의 경로를 결정하며, 결정된 경로에 따라 패킷을 전송한다.`
- 패킷 필터링(ACL)을 통해 불필요한 트래픽 전송을 차단할 수 있다.
- QoS(Quality of Service) 기능을 통해 프로토콜이나 데이터의 크기, 중요도 등에 따라 트래픽 전송순서를 조절할 수 있다.

# 전송 계층(Transport)

- 데이터 전송 단위로 `세그먼트(segment)`를 사용한다.
- 대표적인 보안 프로토콜로 `SSL / TLS`가 있다.
- `종단 노드 간의(종단 프로세스 간) 신뢰성 있는 데이터 전송`을 담당한다.

# 표현 계층(Presentation Layer)

- 송수신 자가 정보를 이해할 수 있도록 `표현방식의 변환을 담당하는 계층`이다.
- `데이터 변환 기능`
  - 송신자와 사용하는 메시지 형식을 수신자가 해석할 수 있도록 미리 정의된 형식으로 변환하며, 수신지에선 수신자가 이해할 수 있는 형식으로 변환한다.
- `암호화 / 복호화`
  - 암호화와 복호화를 통하여 데이터의 보안성을 제공한다.
- `압축 / 압축해제`
  - 송신 측에선 데이터의 압축을 통하여 전송률을 높이고 수신 측에선 압축해제를 통해 데이터를 이용한다.
- `인코딩 / 디코딩`
  - 서로 다른 형태의 코드 변환을 수행한다.

# PDU(Protocol Data Unit)

- OSI 7 Layer 계층별 프로토콜의 데이터 단위를 의미한다.

1. Physical Layer(L1 : 물리 계층)[L1PDU] : `비트(bit)`
2. Data Link Layer(L2 : 데이터 링크 계층)[L2PDU] : `프레임(Frame)`
3. Network Layer(L3 : 네트워크 계층)[L3PDU] : `패킷(Packet)`
4. Transport Layer(L4 : 전송 계층)[L4PDU] : `세그먼트(Segment)`
5. Session/Presentation/Application Layer(L5 / L6 / L7 : 세션 / 표현 / 응용 계층) : `데이터(Data)`

# VLAN(Virtual LAN)

- 데이터링크 계층에서 `브로드캐스트 도메인을 나누기 위해 사용하는 기술`이다.
- `물리적인 네트워크 구조의 변경 없이 스위치에서 제공하는 기능을 통해 논리적으로 서브넷을 구성`할 수 있다.
- VLAN을 통해 가상의 브로드캐스트 도메인을 생성함으로써 브로드캐스트 트래픽을 제한하여 전체 네트워크 서비스의 성능 향상을 기대할 수 있다.
- `서로 다른 VLAN에 대해 서로 다른 보안 정책(네트워크 자원 접근 제한)을 적용할 수 있으므로 보안성을 높일 수 있다.`
- 즉, `네트워크 자원을 제한함으로써 보안성을 높일` 수 있고, `브로드캐스트 도메인의 크기를 줄여 브로드캐스트 트래픽 양을 줄이는 효과`가 발생하고 결과적으로 `전체 네트워크 서비스의 성능을 향상`시킬 수 있다.

## VLAN 종류

1. Port 기반 VLAN

- 스위치 포트를 각 VLAN에 할당한다.
- 같은 VLAN에 속한 포트에 연결된 호스트들 간에만 통신이 가능한 VLAN이다.

2. MAC 기반 VLAN

- 호스트들의 MAC 주소를 VLAN에 등록하여 같은 VLAN에 속한 MAC 주소의 호스트들 간에만 통신이 가능한 VLAN이다.
- 호스트들의 MAC 주소를 전부 등록하고 관리해야 하는 어려움이 있다.

3. 네트워크 주소 기반 VLAN

- 네트워크 주소별로 VLAN을 구성하여 같은 네트워크에 속한 호스트들 간에만 통신할 수 있도록 구성한 VLAN이다.

4. 프로토콜 기반 VLAN

- 같은 통신 프로토콜을 가진 호스트들 간에만 통신할 수 있도록 구현한 VLAN이다.

# ARP(Address Resolution Protocol)

- IP 주소 -> MAC 주소
- ARP 프로토콜은 로컬 네트워크의 모든 호스트에게 대상 IP를 가진 호스트의 MAC 주소를 질의하는 요청 메시지를 만들어 브로드캐스트로 요청하고, 대상 IP가 설정된 호스트는 자신의 MAC 주소를 담은 응답 메시지를 만들어 요청한 호스트에게 유니캐스트로 응답한다.
  - 즉, `요청 메시지를 전송할 때는 이더넷 프레임의 목적지 MAC 주소 필드에 브로드캐스트 주소인 FF:FF:FF:FF:FF:FF`(48bit 모두 1로 설정된 주소로 8bit 단위 헥사값으로 :(콜론)으로 구분된 표현)가 설정된다.

# RARP(Reverse ARP)

- MAC 주소 -> IP 주소

# ARP 스푸핑(Spoofing)

-`Spoofing = 속이기, 속임수`

- MAC 주소를 속이는 공격이다.
- 로컬에서 통신하고 있는 서버와 클라이언트의 IP 주소에 대한 2계층 `MAC 주소를 공격자의 MAC 주소로 속임`으로써 클라이언트에서 서버로 가는 패킷(혹은 서버에서 클라이언트로 가는 패킷)의 흐름을 왜곡시킨다.
  - 즉, 공격자가 다른 호스트의 MAC 주소를 자신의 MAC 주소로 위조한 응답 메시지를 만들어 지속적으로 희생자에게 전송한다.
    - 지속적으로 전송하면, 희생자의 캐시(Cache) 정보가 조작되어 희생자가 조작된 호스트로 패킷을 전송할 때 캐시에 저장된 조작된 MAC 주소로 데이터를 전송하게 된다.

# 스위치 재밍(Switch Jamming)

- MAC 플러딩(Flooding)이라고도 한다.
- 스위치 장비들은 `MAC 주소 테이블이 가득 차게 되면 모든 네트워크 세그먼트 트래픽을 브로드캐스트하는 특징`을 가지고 있다.
  - 즉, 공격자는 위조된 MAC 주소를 지속해서 네트워크에 흘림으로써 스위칭 허브의 주소 테이블을 오버플로우시켜 허브처럼 동작하게 하여 해당 네트워크 세그먼트의 데이터를 스니핑할 수 있게 된다.
    - 이는 스위치 장비들이 보안원리인 하나인 "Fail Close"를 따르지 않기 때문이다.
- 즉, `공격자가 만들어 낸 임의의 ARP 패킷의 MAC 주소가 스위치의 주소 테이블을 오버플로우 시키게 되면 공격이 성공`한다.

# TTL(Time to Live)

- IPv4에서 무한 루핑을 방지하기 위해 `라우터를 거칠 때마다 감소시키는 IP 헤더 필드명`이다.
- 목적지로 가기 위해 `IP 패킷이 경유할 수 있는 라우터의 개수(홉 카운터)`를 의미한다.
- 라우터를 거치면서 `TTL은 1씩 감소하며 목적지 도착 전에 TTL 값이 0이 되면 해당 패킷을 폐기한 후 ICMP 에러 메시지를 최초 출발지로 전송`한다.

# IP 데이터그램을 단편화할 때 tcpdump의 출력 형식

```
frag id:size@offset+
```

id

- 단편화 전 원본 IP 데이터그램을 식별 하기 위한 단편 ID를 의미한다.

size

- IP 헤더를 제외한 단편의 크기로 바이트 단위로 표시한다.

offset+

- 단편의 상대위치를 나타내며 +는 추가 단편이 있음을 의미하고, +가 없으면 마지막 단편을 나타낸다.

예)

```
frag 22666:48@2960+
```

- 단편(Fragment)의 ID는 22666이다.
- IP 헤더를 제외한 단편의 크기는 48을 의미한다.
- 2960+는 단편의 상대위치(Offset)가 2960이고, 추가 단편이 있음(+)을 의미한다.

# MTU가 1500바이트일 때 첫 번째 단편의 크기

- 첫 번째 IP 단편은 MTU에 따라 1500바이트이며, 이중 IP 헤더는 20바이트이다.
- 실제 데이터의 크기는 1500바이트에서 20바이트를 뺀 1480바이트이다.

# IP 스푸핑(Spoofing)

- Spoofing = 속임수
- 트러스트 관계가 맺어져 있는 서버와 클라이언트를 확인한 후 클라이언트에 DoS 공격을 하여 연결을 끊는다.
  - 그 후 공격자가 `클라이언트의 IP 주소를 확보하여 서버에 실제 클라이언트처럼 패스워드 없이 접근하는 공격`이다.
    - 트러스트 관계를 사용하지 않는 것이 최상의 대응책이다.

# 트러스트 관계

- `신뢰 관계에 있는 시스템 간에 별도의 로그인 없이 IP 기반의 인증을 수행하고 접속`하는 방식이다.
- `아이디와 패스워드를 사용하지 않기 때문`에 스니핑 공격에 의한 노출을막을 순 있지만, IP 스푸핑에는 취약하다.

# IPv4에서 IPv6로 전환하는 방법

## 듀얼스택(Dual Stack)

- IPv4와 IPv6 프로토콜을 동시에 설정하여 통신 상대에 따라 선택적으로 사용할 수 있도록 하는 방식이다.

## 터널링

- IPv4 네트워크를 경유하여 IPv6 네트워크 간 통신을 위한 방식이다.
- IPv4 네트워크를 통과 하는 가상의 경로(터널)를 만들어 통신하는 방법이다.

## 주소/헤더 변환(Address / Header Translation)

- 변환 헤더를 추가하여 IPv4 주소를 IPv6 주소로 변환하거나 IPv6 주소를 IPv4 주소로 변환하여 통신하는 방식이다.

# ICMP(Internet Control Message Protocol)

- IP 프로토콜의 비 신뢰적인 특성을 보완하기 위한 프로토콜이다.
- IP 패킷 전송 중 에러가 발생하면 에러 발생 원인을 알려주거나, 네트워크 상태를 진단하는 기능을 제공한다.
- 두 호스트 간, 또는 하나의 호스트와 라우터 같은 네트워크 장비 사이에서 에러 메시지를 주고받을 때 사용한다.
- TCP/IP 프로토콜 그룹에 속해 있으며, RFC 792에 의해 규정되어 있다.

# ICMP Redirect 메시지

- 호스트가 목적지 주소로 연결하고자 할 때, 해당 라우터가 최적의 경로를 호스트에게 다시 알려주기 위하여 라우터에서 호스트로 보내는 메시지이다.

# IGMP(Internet Group Management Protocol)

- 멀티캐스트를 지원하는 라우터가 멀티캐스트 그룹에 가입한 네트워크 내의 호스트를 관리하기 위해 사용하는 프로토콜이다.
- IGMP는 ICMP와 마찬가지로 IP 사우이 계층에 존재하며 IP 패킷으로 캡슐화되어 전송한다.

# TCP 프로토콜의 제어 플래그

| 플래그 | 의미                                                                                                                                                                                                                                               |
| :----: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  URG   | 수신 측에 긴급 데이터 전송을 알리는 제어 플래그(제어비트)                                                                                                                                                                                          |
|  ACK   | 송신 측에 보낸 데이터가 정상 수신되었음을 알리는 제어 플래그(제어비트)                                                                                                                                                                             |
|  PSH   | 즉시 처리가 필요한 데이터라는 것을 알리는 제어 플래그(제어 비트)<br>- 송신 측 동작 : 송신 버퍼(send buffer)에 있는 데이터를 즉시 전송한다.<br>- 수신 측 동작 : 수신 버퍼(receive buffer)에 있는 데이터를 상위 애플리케이션 계층으로 즉시 전달한다. |
|  RST   | 연결 중단(강제 연결 초기화)을 알리는 제어 플래그(제어비트)                                                                                                                                                                                         |
|  SYN   | 연결 설정을 알리는 제어 플래그(제어비트)                                                                                                                                                                                                           |
|  FIN   | 연결 종료(정상 연결 해제)를 알리는 제어 플래그(제어비트)                                                                                                                                                                                           |

# 소켓(Socket)

- 특정 IP 주소와 포트 번호의 조합이다.
- 같은 IP의 동일한 시스템이 동시에 특정 클라이언트의 복수 개의 응용 프로그램에 정확하게 통신할 수 있게 해주는 기반을 제공해주는 소프트웨어 모듈이다.
- 호스트/프로세스 간 통신을 위한 소프트웨어 모듈을 의미한다.
- 네트워크 프로그램 작성 시 OS에서 제공해주는 소켓 라이브러리를 이용하여 프로그래밍한다.

# Well Known 포트(0 ~ 1023)

- 잘 알려진 서비스에 할당된 포트이다.
- 관리자(root, admin)가 서버 프로세스(데몬)을 실행하기 위해 사용하는 포트이다.
- 일반 사용자가 해당 포트를 사용하면 권한 문제가 발생한다.

## 프로토콜과 포트번호

|   프로토콜   | 포트번호 | 설명                                                     |
| :----------: | :------: | :------------------------------------------------------- |
|  FTP, Data   |    20    | 파일 전송 프로토콜(FTP)의 데이터 채널                    |
| FTP, Control |    21    | 파일 전송 프로토콜(FTP)의 제어체널                       |
|    TELNET    |    23    | 터미널 네트워크(Terminal Network)                        |
|     SMTP     |    25    | 간단한 메일 전송 프로토콜(Simple Mail Transfer Protocol) |
|     DNS      |    53    | 도메인 네임 시스템(Domain Name System)                   |
|    BOOTP     |    67    | 부트스트랩 프로토콜(BOOTstrap Protocol)                  |
|     HTTP     |    80    | 하이퍼텍스트 전송 프로토콜(Hypertext Transfer Protocol)  |

# Registered Port(1024 ~ 49151)

- 일반 사용자가 서버 프로세스(데몬)를 실행하기 위해 사용하는 포트이다.
- 대표적으로 DBMS에서 사용하는 포트를 들 수 있다.
  - MySQL(3306/tcp), MS-SQL(1433/tcp), Oracle(1521/tcp)

# TCP

- 전송 계층에서 데이터 전송에 사용하는 프로토콜이다.
- `연결 지향적이고, 신뢰할 수 있는 특성`이 있다.

# UDP

- 전송 계층에서 데이터 전송에 사용하는 프로토콜이다.
- `비 연결형이고, 신뢰성은 보장하지 못하지만, 가볍고 빠른 전송이 가능`하다.

# 세션 하이재킹(Session Hijacking)

- 공격자가 `인증이 완료된 정상적인 사용자 세션을 중간에 가로채서 별도의 인증작업 없이 정상적인 사용자로 위장하여 가로챈 세션으로 통신하는 행위`이다.
- 정상적인 인증이 완료된 세션을 가로채기 때문에 사용자 인증기법을 사용한다고 해도 이를 무력화할 수 있다.

## TCP 세션 하이재킹(TCP Session Hijacking)

- TCP의 세션 관리 취약점을 이용한 공격이다.
- 정상 사용자의 `세션 관리 정보(출발지 IP, Sequence Number 등)를 위조하여 TCP 세션을 가로채는 공격`이다.
- 즉, `공격자는 정상적인 사용자의 출발지(Source) IP와 Port를 위조하고 순서번호(Sequence Number)를 예측하여 세션을 탈취`하게 된다.

## HTTP 세션 하이재킹(HTTP Session Hijacking)

- HTTP의 세션 관리 취약점을 이용한 공격이다.
- 정상 사용자의 `HTTP 세션 ID를 탈취하여 정상 사용자로 위장하여 서버에 접근하는 공격`이다.

# NetBIOS(Network Basic Input/Output System)

- IBM PC를 위한 네트워크 인터페이스 체계이다.
- `네임, 세션, 데이터그램`의 세 가지 서비스를 제공하고 있다.
- 윈도우 NT 시스템이 인터넷에 직접 연결되어 있으면 공격자가 쉽게 파일 시스템을 사용할 수 있으므로, netbios에 대한 접근통제가 적용되어야 한다.

netbios를 차단하기 위한 포트

- netbios : tcp/udp 135 ~ 139

# CIFS(Common Internet File System)[SMB(Server Message Block)]

- 주로 `윈도우 운영체제 환경에서 사용되는 파일, 프린터, 직렬 포트 등에 대한 공유 프로토콜`이다.
  - 유닉스/리눅스에선 삼바(SAMBA) 소프트웨어를 설치하면 SMB를 이용한 유닉스/리눅스와 윈도우 컴퓨터 간 공유가 가능하다.
- 초기 SMB는 NetBIOS API에서 동작했으며 TCP 139번 포트를 사용했다.
- 윈도우 2000이후 `CIFS(Common Internet File System)으로 명칭을 변경`했다.
  - `NetBIOS에 의존하지 않고 TCP 445번 포트를 사용한 직접 통신`을 지원한다.
- 네트워크에 연결된서로 다른 운영체제 간 자원을 쉽게 공유할 수 있지만, 여러 보안 취약점으로 인해 `컨피커 웜 바이러스, 워너크라이(워너 크립터) 랜섬웨어, 워너마인(WannaMine) 암호화폐 채굴 악성코드 등에 악용`되어 왔다.

CIFS(SMB)를 차단하기 위한 포트

- CIFS(SMB) : tcp 445

# ping

- `ICMP Echo Request 메시지를 특정 호스트에 송신하여, 이에 대한 ICMP Echo Reply를 수신`함으로써 호스트의 활성화 여부를 검사하고, `요청과 응답에 대한 경과 시간 RTT(Round Trip Time)을 알아볼 때 사용`한다.
- 원격 호스트에 대한 접근성(활성화 여부) 및 해당 구간에 대한 네트워크 속도(왕복 시간) 및 품질(손실률)을 검사하기 위한 명령어이다.

# netstate 명령어

- 시스템의 `네트워크 관련 다양한 상태정보를 확인할 수 있는 유닉스/리눅스/윈도우 시스템의 내장 명령어`이다.
  - 네트워크 인터페이스에 대한 정보, 라우팅테이블 정보, 소켓 상태정보, 프로토콜별 통계 정보 등 지정 옵션에 따라 다양한 네트워크 관련 정보를 제공한다.
- 공격자의 시스템 침입 경로를 확인하는 방법 중 `공격자가 현재 시스템과 통신하고 있는지 확인한다.`

## netstate 명령어 옵션

|      옵션       | 내용                                                    |
| :-------------: | :------------------------------------------------------ |
|   -l(listen)    | 연결 가능한 상태                                        |
| -n(number port) | 포트 넘버                                               |
|    -t (tcp)     | tcp                                                     |
|    -y (udp)     | udp                                                     |
|     -p(PID)     | 프로그램 이름 / PID 번호                                |
|       -a        | 모든 상태의 소켓 정보를 출력한다.(LISTEN / ESTABLISHED) |
|       -s        | 네트워크 통계<br>기본값은 IP, ICMP, TCP, UDP이다.       |

## 자주 사용하는 netstate 옵션 예시

1. netstate -anp

- 연결을 기다리는 목록과 프로그램을 보여준다.

2. netstate -an | grep 포트번호

- 특정 포트가 사용중인지 확인한다.

3. netstate -nlpt

- TCP listening 상태의 포트와 프로그램을 보여준다.

4. netstate -anb

- 자세한 라이브러리까지 보여준다.

5. netstate -ano

- anb옵션 대용으로 사용되며, PID를 표시한다.

netstate 명령어 뒤에 숫자를 붙이면 숫자에 한번 씩 명령어를 실행한 결과가 출력된다.
ex) netstate 10 => 10초마다 한번 씩 명령어를 실행한 결과가 출력된다.

# traceroute

- `유닉스/리눅스` 시스템에서 'traceroute' 명령은 `종단 노드 사이에 있는 여러 중계 노드 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어`이다.
- 최종 목적지 노드에 도달하는데 `경유하는 중계 노드(라우터)의 개수, IP 주소, 응답시간 등을 파악`할 수 있다.
- 목적지 호스트 포트(33434/udp 이상)로 `UDP 패킷의 TTL 값을 1씩 증가`시킨다.

1. 처음에는 IP 패킷의 TTL 필드값이 1인 패킷을 보낸다.
2. 이 패킷이 도달한 라우터에서는 TTL 필드값이 감소하게 되고 ICMP 프로토콜에 의해 시간초과 오류 메시지(Time Exceeded)를 출발지로 보낸다.
3. 다음은 TTL 필드 값이 2인 패킷을 보내 라우터 정보를 얻어오는 방식을 반복함으로써 최종 목적지까지의 경로를 확인할 수 있다.

# tracert

- 점검용 호스트에서 목적지 호스트까지 경유하게 되는 L3 장비(라우터 등)의 개수, IP 주소, 구간별 응답시간 등 네트워크 상태를 점검하기 위한 `윈도우 유틸리티 프로그램`이다.
- 목적지 호스트로 `ICMP Echo Request 패킷의 TTL값을 1씩 증가`시킨다.

1. L3 장비 구간의 네트워크 상태 점검을 위해 ICMP 프로토콜을 사용하여 패킷을 전송하는데, 이때 IP 헤더의 TTL 필드값을 1로 설정한다.
2. 해당 패킷이 첫 번째 L3 장비에 도착하면 TTL 필드값이 1 감소하여 0이되며 L3 장비는 TTL 필드값이 0인 패킷을 폐기하며, ICMP 프로토콜을 이용하여 최초 출발지로 패킷이 폐기되었음을 알린다.
3. 이 과정을 통해 L3 장비의 IP 주소와 구간 상태를 점검할 수 있으며, TTL 필드값을 1씩 증가시킴으로써 이후의 L3 장비들을 점검할 수 있다.

# 포트 스캐닝(Port Scanning)

- 공격자가 `침입 전 대상 시스템에 어떤 포트(서비스)가 열려있는지 확인`하는 작업이다.
- `대상 서버의 동작 여부와 제공하는 서비스 등을 확인할 수 있다.`

## TCP 포트 스캔 방법

|              스캔 방법               | 설명                                                                                                                                                                                                                                     |
| :----------------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TCP Full Open 스캔(TCP Connect 스캔) | 신뢰성 있는 결과를 얻을 수 있지만, `속도가 느리고 로그를 남기므로 탐지가 가능하다.`<br>- `포트가 열려 있을 경우 SYN/ACK 패킷을 수신하면, ACK 패킷을 전송함으로써 연결을 완료한다.`<br>- `포트가 닫혀 있을 경우 RST/ACK 패킷을 전송한다.` |
|               SYN Scan               | `로그가 남지 않아 추적이 불가능한 기법이다.`<br>- `포트가 닫히면 RST`응답<br>- `포트가 열리면 SYN + ACK` 응답                                                                                                                            |
|             TCP FIN Scan             | TCP 헤더 내에 FIN 플래그를 설정하여 공격 대상 시스템으로 메시지를 전송한다.<br>- `포트가 열려 있을 경우 응답이 없다.`<br>- `포트가 닫혀있을 경우 RST 패킷이 되돌아온다.`                                                                 |
|            TCP NULL Scan             | TCP 헤더 내에 플래그 값을 설정하지 않고, 전송한다.<br>- `포트가 열려 있을 때 응답이 없다.`<br>- `포트가 닫혀 있을 때 RST 패킷이 되돌아온다.`                                                                                             |
|            TCP XMAS Scan             | TCP 헤더 내에 ACK, FIN, RST, SYN, URG 플래그를 모두 설정하여 전송한다.<br>- `포트가 열려 있을 때 응답이 없다.`<br>- `포트가 닫혀 있을 때 RST 패킷이 되돌아온다.`                                                                         |
|              Decoy Scan              | 스캔을 당하는 타겟 호스트에서 스캐너 주소를 식별하기 어렵도록 실제 스캐너 주소 외에도 다양한 위조된 주소로 스캐닝하는 기법이다.                                                                                                          |

# 스텔스 스캔(Stealth Scan)

- 세션이 완전히 성립되지 않은 상태에서 공격 대상 시스템에 포트 활성화 여부를 알아내기에 `시스템에 로그가 남지 않는다.`
  - 즉, 공격 대상 시스템 관리자는 어떤 IP를 가진 공격자가 자신의 시스템을 스캔했는지 확인할 수 없다.
- 대표적인 `스텔스 스캔에는 TCP SYN Scan(Half-Open Scan), TCP FIN Scan, TCP NULL Scan, TCP Xmas Scan` 등이 있다.
