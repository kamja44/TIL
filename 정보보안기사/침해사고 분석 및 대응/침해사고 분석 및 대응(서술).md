1. [snort(침입탐지시스템) 탐지 로그](#snort침입탐지시스템-탐지-로그)<br>
2. [SYN_FIN 스캔](#syn_fin-스캔)<br>
3. [IDS(침입탐지시스템)의 침입 판정 오류](#ids침입탐지시스템의-침입-판정-오류)<br>
4. [IDS(침입탐지시스템)의 오용탐지와 이상탐지](#ids침입탐지시스템의-오용탐지와-이상탐지)<br>
5. [HTTP GET Flooding 공격](#http-get-flooding-공격)<br>
   &nbsp;&nbsp;5-1. [HTTP GET Flooding의 snort 탐지 rule](#http-get-flooding의-snort-탐지-rule)<br>
6. [외부 네트워크와 내부 네트워크 사이에 위치한 침입탐지시스템(IDS)은 스위치 장비의 미러링 포트나 탭(TAP) 장비를 이용한 미러링 모드(mirroring mode)로 설치되고, 침입방지시스템(IPS)은 인라인 모드(inline mode)로 설치되어 동작하는 이유](#외부-네트워크와-내부-네트워크-사이에-위치한-침입탐지시스템ids은-스위치-장비의-미러링-포트나-탭tap-장비를-이용한-미러링-모드mirroring-mode로-설치되고-침입방지시스템ips은-인라인-모드inline-mode로-설치되어-동작하는-이유)<br>
7. [NAC(Network Access Control)의 물리적 구성 방식 2가지와 그 특징](#nacnetwork-access-control의-물리적-구성-방식-2가지와-그-특징)<br>

# snort(침입탐지시스템) 탐지 로그

```
10/29-19:33:32.232372 68.127.38.3:23 -> xx.yy.200.17:23
TCP TTL:31 TOS:0x0 ID:39426 IpLen:20 DgmLen:44
****SF Seq: 0x638CECE1Ack: 0x1DB99E53Win: 0x404TcpLen: 24
TCP Options => MSS : 536
```

- 공격으로 탐지된 이유

1. 해당 로그의 TCP 제어비트를 보면(\*\*\*\*SF) SYN, FIN 제어비트가 동시에 설정되어 있다.

- 정상적인 패킷은 연결 오청(SYN)과 연결 종료(FIN)가 동시에 설정될 수 없다.
- SYN_FIN 플래그 설정 여부는 \*\*\*\*SF를 통해 알수 있다.
  - S는 SYN, F는 FIN을 의미한다.

2. 텔넷 연결의 어느 한쪽은 클라이언트로, 1024/tcp 이상의 포트를 사용하는데 위 탐지 내용을 보면 양쪽 모두 23번 포트를 사용하고 있다.

- 차단하는 방법
- 침입탐지시스템(침입방지시스템)을 통해 비정상적인 요청 패킷의 패턴을 등록하여 탐지 및 차단한다.

```
12/29-09:13:32 211.168.38.3:80 -> xx.yy.100.23:80
TCP TTL:31 TOS:0x0 IpLen:20 DgmLen:44
*******SF Seq:0x63BCECE1 AckL0x1DB99E53 Win:0x404 TcpLen:24
```

- 일반적으로 클라이언트 포트는 1024 이상의 포트를 사용하는데, 클라이언트의 출발지 포트가 웹서버와 동일한 80으로 설정되어 있다.
- TCP 제어비트를 보면, SYN, FIN(**\*\*\***SF) 제어비트가 동시에 설정되어 있다.
  - 정상적인 패킷은 연결 요청(SYN)과 연결 종료(FIN)가 동시에 설정될 수 없다.

# SYN_FIN 스캔

- TCP 패킷 중 접속을 맺는 SYN 비트와 접속을 끊는 FIN 비트가 함께 설정된 비정상 패킷 유형 중 하나이다.
- 일부 구형의 IDS/IPS, 방화벽 제품들이 SYN_FIN 제어비트를 포함한 패킷을 제대로 탐지하지 못하고 FIN 제어비트를 포함한 패킷을 무조건 허용하는 경우가 있기에, 보안장비를 우회하여 목표 시스템을 스캔할 수 있다.
- FIN 제어비트는 연결 종료를 의미하므로 일부 시스템에는 FIN 패킷에 대한 로그를 남기지 않는 경우가 있다.
  - 즉, 흔적을 남기지 않고 목표 시스템을 스캔할 수 있다.

# IDS(침입탐지시스템)의 침입 판정 오류

|           오류           | 설명                                                             |
| :----------------------: | :--------------------------------------------------------------- |
| False Positive<br>(오탐) | 공격 행위가 아닌 것을 공격 행위로 탐지하는 판정 오류를 의미한다. |
| False Negative<br>(미탐) | 공격 행위를 탐지하지 못하는 판정 오류를 의미한다.                |

# IDS(침입탐지시스템)의 오용탐지와 이상탐지

- 오용 탐지(misuse detection)
  - 사전에 등록한 알려진 공격 `패턴을 기반으로 공격 행위를 탐지 하는 방식`이다.
  - `지식 기반 탐지` 혹은, `시그니처 기반 탐지`라고도 한다.
  - 알려진 공격 패턴을 기반으로 탐지하기에, `오탐률이 적지만, 미탐률이 높다.`
- 이상 탐지(anomaly detection)
  - 정상적이고 `평균적인 상태를 기준으로 이를 벗어난 행위를 공격 행위로 탐지`하는 방식이다.
  - `행위 기반 탐지` 혹은, `통계 기반 탐지` 라고도 한다.

# HTTP GET Flooding 공격

- 최초 웹페이지에 대한 접속 요청을 폭주시켜 세션 자원을 소진시키는 방법이다.

## HTTP GET Flooding의 snort 탐지 rule

```
alert tcp any any -> any any (msg:"Get Flooding";
content: "GET / HTTP/1."; nocase; depth:13;
threshold: type threshold, track by_dst, count 10, seconds 1; sid:1000999)
```

- snort 탐지 rule의 이벤트 명은 Get Flooding이다.
- nocase
  - content의 내용과 패킷 페이로드의 패턴 매칭 시 대소문자를 구분하지 않는다.
- "GET / HTTP/1."
  - 패킷 페이로드에 "GET / HTTP/1." 문자열이 포함되어 있는지 여부를 검색한다.
  - 이는, HTTP 요청라인(Request Line) 정보를 의미하는 것으로, 각각의 의미는 다음과 같다.
    - GET : GET 메소드 요청
    - / : 요청 URL로, /만 있으면 default page 요청을 의미한다.
    - HTTP/1. : HTTP 버전이 1.대임을 의미한다.
- threshold:type threshold, track by_dst, count 10, seconds 1의 의미
  - 목적지 IP(by_dst)를 기준으로, 매 1초(seconds)동안, 10번째(count) 이벤트마다 alert action을 수행한다.
  - 이벤트 제한(threshold) 유형에 따른 차이점
    - `threshold: type limit`, track by_dst, count 10, seconds 1
      - 목적지 IP(by_dst)를 기준으로, 매 1초동안(seconds) 10번째(count 10) `이벤트까지` alert action을 수행한다.
    - `threshold:type threshold`, track by_dst, count 10, seconds 1
      - 목적지 IP(by_dst)를 기준으로 매 1초동안(seconds 1) 10번째(count 10) `이벤트마다` alert action을 수행한다.
    - `threshold:type both`, track by_dst, count 10, seconds 1
      - 목적지 IP(by_dst)를 기준으로, 매 1초 동안(seconds 1) 10번째(count 10) `이벤트 시 한번 `alert action을 수행한다.

```
alert tcp any any -> any any (msg:"HTTP Get Flooding Detect";
content:"GET / HTTP/1."; nocase; depth:13;
threshold:type threshold, track by_src, count 10, seconds 1; sid:1000999)
```

- snort Rule의 action은 패킷이 탐지(매칭)되었을 때의 처리방식을 의미한다.
  - 탐지된 패킷을 차단하고, 로그를 남기는 action에는 drop, reject 유형이 있다.
  - drop 액션
    - 탐지한 패킷을 차단하고 로그를 남긴 후 차단 메시지를 보내지 않는다.
  - reject 액션
    - 탐지한 패킷을 차단하고 로그를 남긴 후 차단 메시지를 보낸다.(TCP의 경우 TCP Reset으로 응답하고 UDP의 경우 ICMP Port Unrechable 메시지로 응답한다.)
- depth:n
  - content 옵션으로 지정한 문자열을 페이로드의 첫 번째 바이트부터 n번째 바이트 범위 내에서 검사하고자 할 때 사용한다.
- threshold:type threshold, track by_src, count 10, seconds 1; sid:1000999
  - 출발지 IP를 기준으로, 매 1초(seconds) 동안 10번째 이벤트(count 10)마다 alert action을 수행한다.

# 외부 네트워크와 내부 네트워크 사이에 위치한 침입탐지시스템(IDS)은 스위치 장비의 미러링 포트나 탭(TAP) 장비를 이용한 미러링 모드(mirroring mode)로 설치되고, 침입방지시스템(IPS)은 인라인 모드(inline mode)로 설치되어 동작하는 이유

- `침입탐지시스템(IDS)은 공격 패킷을 차단하는 것이 아닌 탐지하는 것을 목적`으로 한다.
  - 즉, 미러링 모드를 통해 복사된 패킷을 이용하는 것이 네트워크 가용성 측면에서 적절하다.
- `침입탐지시스템(IPS)은 공격 패킷을 탐지하고, 차단하는 것을 목적`으로 한다.
  - `실제 패킷이 보안장비를 통과하도록 설치하는 인라인 모드가 적절`하다.
- 네트워크 보안장비의 설치 모드는 미러링 모드(mirroring mode)와 인라인 모드(inline mode)로 구분할 수 있다.

## 미러링 모드(mirroring mode)

- 물리적인 네트워크 경로밖에 위치하여, 미러링 장비(패킷을 복제해주는 장비)로부터 복제된 패킷을 받아서 처리하도록 설치하는 모드이다.
- 물리적인 네트워크 경로밖에 위치하기에, 네트워크 구성 변경이 불필요하고 장비 장애 시 전체 네트워크 장애를 유발하지 않는다.
- 복제된 패킷을 탐지하기에 실시간 차단이 어렵다.

## 인라인 모드(inline mode)

- 물리적인 네트워크 경로상에 위치하여 연결된 네트워크를 통과하는 모든 패킷이 장비를 거쳐가도록 설치하는 모드이다.
- 실제 패킷이 장비를 거쳐가기에 실시간 탐지뿐만 아니라 차단까지 가능하다.
- 물리적인 네트워크 경로상에 위치하기에, 네트워크 구성 변경이 필요하고 장비 장애 시 전체 네트워크 장애를 유발할 수 있다.

# NAC(Network Access Control)의 물리적 구성 방식 2가지와 그 특징

1. 인라인(inline) 방식

- 물리적인 네트워크 경로상에 위치하여 연결된 네트워크를 통과하는 모든 패킷이 장비를 거쳐가도록 설치하는 모드이다.
- 설치된 경로상의 모든 패킷을 직접 통제할 수 있기 떄문에 미러링 방식에 비해 더 강화된 접근 제어가 가능하지만, 기존 네트워크 구성 변경이 필요하고 NAC 장비 장애 시 전체 네트워크 가용성에 영향을 줄 수 있는 단점이 있다.

2. 미러링(mirroring) 방식

- 아웃오브패스(out-of-path) 방식
- 물리적인 네트워크 경로 밖에 위치하여 미러링 장비(패킷을 복제해주는 장비)로부터 복제된 패킷을 받아서 처리하도록 설치하는 모드이다.
- 기존 네트워크의 구성 변경을 최소화하고 손쉽게 설치할 수 있으며, NAC 장비 장애 시 전체 네트워크 가용성에 영향을 주지 않는 장점이 있지만, 복제된 트래픽을 이용하여 접근 제어를 하므로, 미러링 방식에 비해 보안성(접근 차단 성능)이 떨어지는 단점이 있다.
