1. [DNS 스푸핑(DNS Spoofing)](#dns-스푸핑dns-spoofing)<br>
2. [DNS가 TCP 53번 포트를 이용하는 경우](#dns가-tcp-53번-포트를-이용하는-경우)<br>
3. [마스터 및 슬레이브 네임서버의 설정 내용](#마스터-및-슬레이브-네임서버의-설정-내용)<br>
4. [HTTP 쿠키](#http-쿠키)<br>
5. [웹 서버에서 쿠키 배포 시 사용할 수 있는 보안 옵션](#웹-서버에서-쿠키-배포-시-사용할-수-있는-보안-옵션)<br>
6. [HTTP GET 메소드](#http-get-메소드)<br>
7. [HTTP POST 메소드](#http-post-메소드)<br>
8. [FTP Bounce 공격](#ftp-bounce-공격)<br>
9. [Anonymous FTP 공격](#anonymous-ftp-공격)<br>
10. [TFTP(Trival FTP) 공격](#tftptrival-ftp-공격)<br>
11. [FTP Active Mode](#ftp-active-mode)<br>
12. [FTP Passive Mode](#ftp-passive-mode)<br>
13. [스팸메일 방지 기술](#스팸메일-방지-기술)<br>
&nbsp;&nbsp;13-1. [SPF(Sender Policy Framework)](#spfsender-policy-framework)<br>
&nbsp;&nbsp;13-2. [DKIM(DomianKeys Identified Mail)](#dkimdomiankeys-identified-mail)<br>
&nbsp;&nbsp;13-3. [DMARC(Domain-based Message Authentication, Reporting and Conformance)](#dmarcdomain-based-message-authentication-reporting-and-conformance)<br>
&nbsp;&nbsp;13-4. [이메일 전송 과정 중의 RSA 알고리즘](#이메일-전송-과정-중의-rsa-알고리즘)<br>
14. [네트워크 패킷 조사1](#네트워크-패킷-조사1)<br>
# DNS 스푸핑(DNS Spoofing)

- 희생자가 DNS 질의를 수행하면 공격자가 이를 스니핑하고 있다가 희생자에게 조작된 DNS 응답을 보내, 가짜 사이트로 접속을 유도하는 공격기법이다.
- 중요한 사이트의 IP 주소에 대해서는, DNS 질의보다 우선순위가 높은 hosts 파일을 통해 관리한다.

# DNS가 TCP 53번 포트를 이용하는 경우

- 일반적으로, DNS 질의는 UDP 53번 포트를 통해 512바이트 이하의 패킷을 송수신한다.
- 단, 다음과 같은 경우는 TCP를 이용한다.

1. 존 전송(Zone Transfer) 시 53/tcp 포트를 사용한다.

- 마스터에 있는 원본 존 데이터를 슬레이브가 동기화/복사하는 작업을 존 전송이라고 한다.
- 존 전송은 일반적으로 많은 존 데이터를 이동해야 하므로 신뢰성 있는 전송을 보장하는 TCP를 이용한다.

2. 응답 데이터(DNS Answer)가 512 bytes를 초과할 때 53/tcp 포트를 사용한다.

- 클라이언트 질의에 대하여 네임서버 처리 결과 512 bytes를 초과하면 네임 서버는 신뢰성 있는 전송을 보장해 주기 위해 TCP로 재요청하도록 응답한다.
- 해당 응답을 받은 클라이언트는 53/tcp 포트로 재요청을 수행한다.

# 마스터 및 슬레이브 네임서버의 설정 내용

```
slave 1 네임서버 IP : 192.168.56.100
[Master 네임서버의 named.conf 설정 내용]
options{
  allow-transfer {192.168.56.100;};
};
[slave_1 네임서버의 named.conf 설정 내용]
options{
  allow-transfer(none;);
};
```

1. allow-transfer 설정을통해 제공하는 정보의 이름과 제공하는 정보의 내용

- 존(Zone) 정보를 제공한다.
- 존 정보란, 해당 DNS 서버가 위임받은(DNS 서버에 설정된) 도메인에 대한 리소스 레코드 정보(호스트 정보, 네임서버 및 메일서버 정보 등)를 말한다.

2. Master 네임서버 설정 파일(named.conf)의 설정 내용의 의미

- slave 1 네임서버에 대한 존 전송(zone transfer)을 허용한다.

3. slave_1 네임서버 설정 파일(named.conf)의 설정 내용의 의미

- 모든 네임서버에 대해 존 전송을 허용하지 않는다.

4. 2.3.번 설정이 어떤 공격이나 위협에 대응하기 위함안가?

- 존 전송을 제한하지 않으면 공격자의 지속적인 존 전송 요청을 통해 도스(DoS) 공격으로 악용되거나, 존 데이터에 저장된 해당 도메인의 호스트 정보, 시스템 정보 등이 불필요하게 노출될 수 있는 문제점이 있다.

# HTTP 쿠키

- 서버에서 쿠키를 생성하여 웹 브라우저에 전달할 때 사용하는 HTTP 응답 헤더의 이름

  - Set-Cookie

- 웹 브라우저가 쿠키를 서버로 전달할 때 사용하는 HTTP 요청 헤더의 이름

  - Cookie

- 쿠키 관련 보안 속성 중 httponly 속성을 설정할 때의 효과

  - 쿠키에 httponly 속성을 설정하면, 클라이언트(웹 브라우저 등)에서 스크립트(자바스크립트 등)을 통한 해당 쿠키 접근을 차단하기 때문에 쿠키 탈취를 위한 XSS 등의 공격에 효과적으로 대응할 수 있다.

- 쿠키 관련 보안 속성 중 secure 속성
  - 쿠키에 secure 속성을 설정하면, 클라이언트(웹 브라우저 등)에서 HTTPS(SSL/TLS) 통신일 경우에만 해당 쿠키를 전송하기 때문에 전송 중 평문 쿠키가 노출되는 것을 방지할 수 있다.

# 웹 서버에서 쿠키 배포 시 사용할 수 있는 보안 옵션

- Secure

  - 클라이언트(웹 브라우저 등)에서 HTTPS(암호화 통신) 통신일 경우에만 해당 쿠키를 전송하고, HTTP 통신(평문 통신)일 경우에는 전송하지 않는다.
  - 쿠키 정보의 기밀성을 보장할 수 있다.

- HttpOnly

  - 클라이언트에서 스크립트를 통한 쿠키 접근을 차단하도록 설정하는 옵션이다.
  - 악의적인 쿠키 정보 탈취를 방지할 수 있다.
  - XSS 공격을 통해 쿠키 정보를 탈취하는 형태의 공격에 대응 가능하다.

- Expires
  - 쿠키의 유효기간을 설정하는 옵션이다.
  - 유효기간을 최소한으로 설정하여, 쿠키 정보가 클라이언트의 하드디스크 등에 지속해서 남아 공격자에게 노출되는 위험을 방지할 수 있다.

# HTTP GET 메소드

- HTTP 요청 URL의 끝에 데이터를 추가해서 전달하는 방식이다.
- 즉, URL을 이용하여 서버에 자원을 요청한다.
- GET 메소드는 요청 URL 끝에 데이터를 추가해서 전달하기에, 요청 URL 정보를 남기는 클라이언트 히스토리나 서버 액세스 로그에 데이터가 그대로 노출되어 중요정보일 경우 보안상 매우 취약하다.

# HTTP POST 메소드

- HTTP 요청 메시지의 바디부에 데이터를 담아서 전달하는 방식이다.
- POST 메소드는 요청 메시지 바디부에 데이터를 담아서 전달하기에, 클라이언트 히스토리나 서버의 access 로그에 데이터가 남지 않으므로 GET 방식에 비해 안전한다.

# FTP Bounce 공격

- 제어 체널(Control Channel)과 데이터 체널(Data Channel)을 다르게 사용하고, 데이터체널을 생성할 때 목적지를 확인하지 않는 FTP 설계의 구조적 취약점을 이용하는 공격이다.
- 주로 익명 FTP 서버를 이용한다.
- PORT 명령을 조작하여, 공격 대상 네트워크를 스캔하고 FTP 서버를 통해 공격자가 원하는 곳으로 데이터를 전송하게 한다.

# Anonymous FTP 공격

- 익명 FTP 서비스는 익명 계정(anonymous)으로 FTP 접속이 가능한 서비스를 말한다.
- 익명 계정을 허용하면 원격에서 인증 없이 누구나 서버의 파일에 접근할 수 있으므로, 보안상 심각한 문제가 발생할 수 있다.
- 만일, 익명사용자 에게 쓰기 권한까지 있다면, 악성코드를 업로드하여 다수의 사용자에게 피해를 발생시킬 수 있다.

# TFTP(Trival FTP) 공격

- TFTP는 간단하고 단순한 파일 송수신 프로토콜이다.
- 자체 디스크가 없는 워크스테이션에 부팅이미지를 전달할 목적으로 주로 사용한다.
- TFTP는 별도의 인증과정 없이 지정된 디렉터리에 접근할 수 있는 보안상 취약점이 존재한다.

# FTP Active Mode

- 능동 모드로 데이터를 전송하기 위해선 FTP 서버(20/TCP 포트)에서 PC(1024/TCP 이상 포트)로 연결되어야 한다.
- 능동 모드로 데이터 채널을 연결하기 위해선 PC 방화벽에 FTP 서버(20/TCP 포트)에서 PC의 연결요청을 허용해야 한다.
- `클라이언트에서 FTP 서버로 접속하여 제어 체널을 생성하고 FTP 서버에서 클라이언트로 접속하여 데이터채널을 생성한다.`
  - 접속 포트(제어 채널)
    - 클라이언트(1024/TCP 이상 포트) -> 서버(21/TCP 포트)
- 능동 모드에서 데이터 목록을 받기 위한 데이터 채널을 형성하기 위해선 FTP 서버(20/TCP 포트)에서 클라이언트(1024/TCP 이상 포트)로 연결해야 하는데, 방화벽에서 1024/TCP 이상 포트로 연결요청을 허용하지 않으면, 데이터 채널 연결이 불가능하여 데이터 목록을 가져오지 못하는 문제가 발생한다.

# FTP Passive Mode

- 수동 모드로 데이터를 전송하려면, 데이터 체널이 PC(1024/TCP)에서 FTP 서버(1024/TCP 이상 포트)로 연결된다.


# 스팸메일 방지 기술

## SPF(Sender Policy Framework)
- `발신 메일서버 정보를 사전에 발신 도메인 DNS 서버에 공개적으로 등록`함으로써, `수신자가 수신한 메일의 발신자 IP 주소가 발신자 메일주소 도메인(MAIL FROM 정보)의 실제 메일서버 정보(IP 주소)와 일치하는지 검사할 수 있도록 하는 이메일 인증 기술`이다.
  - 발신자의 메일주소 도메인의 DNS에 등록된 SPF 레코드를 조회하여(TXT 레코드 질의) 실제 메일을 발송한 메일서버의 IP가(메시지 패킷에서 확인 가능) 조회한 SPF 레코드에 등록된 서버인지를 확인할 수 있다.
- 즉, 정단한 발신자인지 확인한다.
- SPF 인증 결과는 메일 헤더의 'Received-SPF'필드 또는 'Authentication-Results'필드를 통해 확인할 수 있다.
## DKIM(DomianKeys Identified Mail)
- `발신자가 발신 메일의 메시지 헤더와 바디에 대한 디지털서명을 메일 헤더에 삽입`하여 수신된 이메일이 위변조되지 않았는지 `수신자가 검증`할 수 있는 이메일 인증 기술이다.
- 발신자(발신자 메일서버)는 `발신 메일의 메시지 헤더와 바디를 자신의 개인키로 전자서명한 후, 서명값을 메일 헤더(DKIM-Signature 헤더)에 추가`하여 전송한다.
- 수신자는 `발신자의 도메인의 DNS에 등록된 전자서명을 검증할 수 있는 정보(서명 알고리즘, 공개키)를 담고 있는 DKIM 레코드를 조회하여 서명검증을 수행`한다.
- 즉, 메일의 위변조 여부를 판단한다.
## DMARC(Domain-based Message Authentication, Reporting and Conformance)
- `SPF 인증 기술과 DKIM 인증 기술을 DMARC 인증정책을 통해 모두 적용하여, 정당한(인증된) 발신자인지와 메일의 위변조 여부를 검사`하고, `수신 측에서 정책 처리 결과(인증 실패)에 대한 DMARC 보고서를 발신자에게 전달함으로써 발신자가 메일 모니터링을 할 수 있는 이메일 인증 기술`이다.

## 이메일 전송 과정 중의 RSA 알고리즘
```
(version=TLS1 2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128)
```
- RSA 알고리즘은 상대방에 대한 인증(인증서 인증 및 키교환 시 사용하는 매개변수에 대한 서명) 목적으로 사용한다.
- TLS의 암호도구목록(Cipher suite)에 관한 내용으로 각 항목의 의미는 아래와 같다.
- ECDHE -> 키 교환 알고리즘(Elliptic Curve Diffie-Hellman Ephemeral : 타원 곡선 임시 디피-헬만 방식 사용)
- RSA -> 인증/서명 알고리즘(인증서 인증 및 키 교환 시 사용하는 매개변수에 대한 서명)
- AES128-GCM-SHA256 -> 암호 명세(대칭키 암호화로 128비트 AES를 사용하며, 블록 암호 운용모드로 GCM을 사용하고, HMAC 알고리즘(메시지 무결성과 인증)으로 SHA256을 사용한다.)

# 네트워크 패킷 조사1
```
GET /abc.asp HTTP/1.1
Host : 192.168.159.131
User-Agent: Mozilla/5.0 ~~~
Referer : h://www.attacker.co.kr/default.jsp
Cache-Control : max-age = 0
```

- HTTP 요청 헤더의 의미
  - Refer 요청 헤더
    - 링크를 통해 페이지에 접근할 때, 해당 링크가 있는 이전 페이지의 URL을 의미한다.
      - 즉, A라는 페이지에서 링크를 클릭해서 B라는 페이지에 접근하게 되면, A라는 페이지가 Referer가 된다.
  - Cache-Control 요청 헤더
    - max-age = 0
      - 캐시 서버에 저장된 요청 자원의 유효성 유무와 무관하게, 원본 웹서버로 유효성 검증을 다시 하라는 의미이다.
      - 유효성 검증을 한다는 것은 캐시 서버에 저장된 자원이 원본 웹서버에 저장된 자원과 일치하는지를 확인하는 것이다.
    - no-cache
      - Cache-Control 요청 헤더에 no-cache 옵션을 지정하면, 캐시 서버에 저장된 요청 자원이 아닌 무조건 원본 웹서버에 저장된 자원으로 응답하라는 의미이다.

- 공격의 경로와 영향
  - 공격 대상 웹서버(192.168.159.131)의 /abc.jsp 자원에 대한 요청은 h://www.attacker.co.kr/default.jsp 페이지를 거쳐 이뤄졌다.
  - Cache-Control 요청 헤더에 max-age=0 옵션을 설정하여, 캐시 서버가 항상 원본 웹서버에 요청 자원에 대한 유효성검증을 하도록 하여, 캐시 서버를 무력화시키고 원본 웹서버에 부하를 발생시킨다.

# Prepared Statement(선처리 질의문)
- 외부로부터 입력값(변경되는 값)을 제외한 질의문 부분을 미리 컴파일하여(질의문 분석 및 최적화) 생성한 후 반복적으로 입력값만을 매개변수로 전달하여 질의문을 실행하는 방식이다.
- `사전에 컴파일된 질의문을 이용하는 방식`으로, 이후 입력되는 `사용자 입력(매개변수)은 질의문 자체를 변경할 수 없고, 별도의 매개변수로 전달되어 실행되기 때문에 공격자가 악의적인 입력값을 삽입한다 하더라도, SQL 질의문 자체에 영향을 미치지 않는다.`
  - 즉, SQL 인젝션 공격에 효과적으로 대응할 수 있다.